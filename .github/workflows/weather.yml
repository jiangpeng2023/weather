name: æ¯æ—¥æ¿æ¡¥å¤©æ°”
on:
  schedule:
    - cron: '0 23 * * *' # UTC 23:00 = JST 08:00
  workflow_dispatch:
    inputs:
      city:
        description: 'åŸå¸‚'
        required: false
        default: 'Itabashi,JP'

jobs:
  get-weather:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v5
    - name: è·å–å¤©æ°”æ•°æ®
      id: fetch
      env:
        CITY: ${{ inputs.city || 'Itabashi,JP' }}
      run: |
        curl -s "https://api.openweathermap.org/data/2.5/forecast?q=$CITY&appid=${{ secrets.WEATHER_API_KEY }}" | \
        jq '.list[0] | {temp: ((.main.temp - 273.15 | round | tostring) + "â„ƒ"), desc: .weather[0].description, pop: ((.pop * 100 | floor | tostring) + "%")}' > weather.json
        cat weather.json
        echo "::notice title=ä»Šæ—¥å¤©æ°”:: $(cat weather.json)"
    - name: åˆ›å»º Issue
      if: success()
      uses: actions/github-script@v7
      with:
        script: |
          const fs = require('fs');
          const weather = JSON.parse(fs.readFileSync('weather.json'));
          const city = process.env.CITY || 'æ¿æ¡¥';
          await github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: `${city} å¤©æ°”æŠ¥å‘Š (${new Date().toLocaleDateString('ja-JP')})`,
            body: `ğŸŒ¤ï¸ **æ¸©åº¦**: ${weather.temp}\nâ˜ï¸ **æè¿°**: ${weather.desc}\nğŸŒ§ï¸ **é™æ°´æ¦‚ç‡**: ${weather.pop}`
          });
